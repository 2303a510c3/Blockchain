import tkinter as tk
from tkinter import messagebox, ttk

# ---------------- TOKEN LOGIC ----------------
class ERC20Token:
    def __init__(self, supply):
        self.name = "MyToken"
        self.symbol = "MTK"
        self.decimals = 18
        self.total_supply = supply * (10 ** self.decimals)

        self.balances = {"Creator": self.total_supply}
        self.history = []

    def transfer(self, sender, receiver, amount):
        if sender not in self.balances:
            return "Sender does not exist"

        if amount <= 0:
            return "Invalid amount"

        if self.balances.get(sender, 0) < amount:
            return "Insufficient Balance"

        self.balances[sender] -= amount
        self.balances[receiver] = self.balances.get(receiver, 0) + amount

        record = f"{sender} â†’ {receiver} : {amount}"
        self.history.append(record)

        return "Transfer Successful"

    def balance_of(self, user):
        return self.balances.get(user, 0)


# ---------------- GUI ----------------
def create_token():
    try:
        supply = int(entry_supply.get())
        global token
        token = ERC20Token(supply)

        update_balance_list()

        messagebox.showinfo("Success", "Token Created Successfully!")
    except:
        messagebox.showerror("Error", "Enter valid supply")


def transfer_token():
    sender = entry_sender.get()
    receiver = entry_receiver.get()

    try:
        amount = int(entry_amount.get())
    except:
        messagebox.showerror("Error", "Invalid amount")
        return

    result = token.transfer(sender, receiver, amount)

    messagebox.showinfo("Transfer Status", result)

    update_balance_list()
    update_history()


def update_balance_list():
    listbox_balances.delete(0, tk.END)
    for user, bal in token.balances.items():
        listbox_balances.insert(tk.END, f"{user} : {bal}")


def update_history():
    listbox_history.delete(0, tk.END)
    for tx in token.history:
        listbox_history.insert(tk.END, tx)


# ---------------- WINDOW ----------------
root = tk.Tk()
root.title("ERC20 Token Wallet")
root.geometry("600x500")

token = None

# Token creation
tk.Label(root, text="Enter Initial Supply").pack()
entry_supply = tk.Entry(root)
entry_supply.pack()

tk.Button(root, text="Create Token", command=create_token, bg="lightgreen").pack(pady=10)

# Transfer section
frame_transfer = tk.LabelFrame(root, text="Transfer Tokens")
frame_transfer.pack(pady=10, fill="both", expand="yes")

tk.Label(frame_transfer, text="Sender").grid(row=0, column=0)
entry_sender = tk.Entry(frame_transfer)
entry_sender.grid(row=0, column=1)

tk.Label(frame_transfer, text="Receiver").grid(row=1, column=0)
entry_receiver = tk.Entry(frame_transfer)
entry_receiver.grid(row=1, column=1)

tk.Label(frame_transfer, text="Amount").grid(row=2, column=0)
entry_amount = tk.Entry(frame_transfer)
entry_amount.grid(row=2, column=1)

tk.Button(frame_transfer, text="Transfer", command=transfer_token, bg="orange").grid(row=3, columnspan=2, pady=5)

# Balance display
frame_bal = tk.LabelFrame(root, text="Balances")
frame_bal.pack(side="left", fill="both", expand=True, padx=10, pady=10)

listbox_balances = tk.Listbox(frame_bal, width=30)
listbox_balances.pack(fill="both", expand=True)

# History display
frame_hist = tk.LabelFrame(root, text="Transaction History")
frame_hist.pack(side="right", fill="both", expand=True, padx=10, pady=10)

listbox_history = tk.Listbox(frame_hist, width=30)
listbox_history.pack(fill="both", expand=True)

root.mainloop()